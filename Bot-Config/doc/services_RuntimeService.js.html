<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/RuntimeService.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/RuntimeService.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import config from '@/services/config'

const URL = `http://${config.server}:3000/api/v1/manage/users/`

/**
 * Credentials.
 *
 * @typedef {Object} Credentials
 * @property {string} username - the username
 * @property {string} password - the password
 */

/**
 * The Runtime service.
 * Provides functionality for accessing and interacting with the bot runtime.
 *
 * @author Marcel Herd
 * @module services/RuntimeService
 */
export default {
  /**
   * Tries to authenticate with the given credentials.
   * Returns a promise containing a token if successful, or an error message otherwise.
   *
   * @method authenticate
   * @param {Credentials} credentials - the credentials to authenticate with
   * @return {Promise} - a promise containing the response
   */
  authenticate (credentials) {
    let url = `http://${config.server}:3000/api/v1/authenticate`

    let payload = JSON.stringify(credentials)

    let headers = new Headers({ 'Content-Type': 'application/json' })
    let request = new Request(url, {
      method: 'POST',
      mode: 'cors',
      headers: headers,
      body: payload
    })

    return fetch(request).then(response => response.json())
  },

  /**
   * Finds the user with the given id.
   *
   * @method findUserById
   * @param {string} userId - the id to search with
   * @return {Promise} - a promise containing the response
   */
  findUserById (userId) {
    return fetch(URL + userId, {
      headers: {
        'x-access-token': localStorage.getItem('token')
      }
    })
    .then(response => response.json())
  },

  /**
   * Finds all users.
   *
   * @method findAllUsers
   * @return {Promise} - a promise containing all users
   */
  findAllUsers () {
    return fetch(URL, {
      headers: {
        'x-access-token': localStorage.getItem('token')
      }
    })
    .then(response => response.json())
  },

  /**
   * Saves the given user.
   *
   * @method saveUser
   * @param {Object} user - the user to save
   * @return {Promise} - a promise containing the response
   */
  saveUser (user) {
    return fetch(URL, {
      method: 'POST',
      mode: 'cors',
      headers: {
        'x-access-token': localStorage.getItem('token'),
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(user)
    })
  },

  /**
   * Updates the given user.
   *
   * @method updateUser
   * @param {Object} user - the user to update
   * @return {Promise} - a promise containing the response
   */
  updateUser (user) {
    let payload = JSON.stringify({
      brandId: user.brandId,
      stagingId: user.stagingId
    })

    let request = new Request(URL + user._id, {
      method: 'PATCH',
      mode: 'cors',
      body: payload,
      headers: {
        'x-access-token': localStorage.getItem('token'),
        'Content-Type': 'application/json'
      }
    })

    return fetch(request).then(response => response.json())
  },

  /**
   * Deletes the user with the given id.
   *
   * @method deleteUser
   * @param {string} userId - the id of the user which is to be deleted
   * @return {Promise} - a promise containing the response
   */
  deleteUser (userId) {
    let request = new Request(URL + userId, {
      method: 'DELETE',
      mode: 'cors',
      headers: {
        'x-access-token': localStorage.getItem('token')
      }
    })

    return fetch(request)
  },

  /**
   * Finds all bots that belong to the user with the given id.
   *
   * @method findBotsByUser
   * @param {string} userId - the id of the user to which the bots belong
   * @return {Promise} - a promise containing the response
   */
  findBotsByUser (userId) {
    return fetch(`${URL + userId}/bots`, {
      headers: {
        'x-access-token': localStorage.getItem('token')
      }
    }).then(response => response.json())
  },

  /**
   * Finds the bot with the given id.
   *
   * @method findBotById
   * @param {string} userId - the id of the user to which the bot belongs
   * @param {string} botId - the id of the bot
   * @return {Promise} - a promise containing the response
   */
  findBotById (userId, botId) {
    return fetch(`${URL + userId}/bots/${botId}`, {
      headers: {
        'x-access-token': localStorage.getItem('token')
      }
    }).then(response => response.json())
  },

  /**
   * Deletes the bot with the given id.
   *
   * @method deleteBot
   * @param {string} userId - the id of the user to which the bot belongs
   * @param {string} botId - the id of the bot
   * @return {Promise} - a promise containing the response
   */
  deleteBot (userId, botId) {
    let request = new Request(`${URL + userId}/bots/${botId}`, {
      method: 'DELETE',
      mode: 'cors',
      headers: {
        'x-access-token': localStorage.getItem('token')
      }
    })

    return fetch(request).then(response => response.json())
  },

  /**
   * Saves the given bot.
   *
   * @method saveBot
   * @param {string} userId - the id of the user to which the bot will belong
   * @param {Object} bot - the bot that is to be saved
   * @return {Promise} - a promise containing the response
   */
  saveBot (userId, bot) {
    bot.template = bot.template.replace(' ', '-')

    let request = new Request(`${URL + userId}/bots/`, {
      method: 'POST',
      mode: 'cors',
      body: JSON.stringify(bot),
      headers: {
        'x-access-token': localStorage.getItem('token'),
        'Content-Type': 'application/json'
      }
    })

    return fetch(request).then(response => response.json())
  },

  /**
   * Updates the given bot.
   *
   * @method updateBot
   * @param {string} userId - the id of the user to which the bot belongs
   * @param {Object} bot - the updated bot
   * @return {Promise} - a promise containing the response
   */
  updateBot (userId, bot) {
    let payload = {
      name: bot.name,
      greeting: bot.greeting,
      environment: bot.environment,
      dialogTree: bot.dialogTree || {},
      intents: bot.intents || []
    }

    let request = new Request(`${URL + userId}/bots/${bot._id}`, {
      method: 'PATCH',
      mode: 'cors',
      body: JSON.stringify(payload),
      headers: {
        'x-access-token': localStorage.getItem('token'),
        'Content-Type': 'application/json'
      }
    })

    return fetch(request).then(response => response.json())
  },

  /**
   * Toggles (starts/stops) the given bot.
   *
   * @param {string} userId - the id of the user to which the bot belongs
   * @param {Object} bot - the bot that is to be started/stopped
   * @return {Promise} - a promise containing the response
   */
  toggleBot (userId, bot) {
    let action = (bot.running ? 'stop' : 'start')
    let request = new Request(`${URL + userId}/bots/${bot._id}/${action}`, {
      method: 'POST',
      mode: 'cors',
      headers: {
        'x-access-token': localStorage.getItem('token'),
        'Content-Type': 'application/json'
      }
    })

    return fetch(request).then(response => response.json())
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-App.html">App</a></li><li><a href="module-components_core_Button.html">components/core/Button</a></li><li><a href="module-components_core_FlashMessage.html">components/core/FlashMessage</a></li><li><a href="module-components_core_FloatingActionButton.html">components/core/FloatingActionButton</a></li><li><a href="module-components_core_FormSection.html">components/core/FormSection</a></li><li><a href="module-components_core_Input.html">components/core/Input</a></li><li><a href="module-components_core_Select.html">components/core/Select</a></li><li><a href="module-components_core_Switch.html">components/core/Switch</a></li><li><a href="module-components_edit_TreeNode.html">components/edit/TreeNode</a></li><li><a href="module-components_layout_header_UserMenu.html">components/layout/header/UserMenu</a></li><li><a href="module-components_layout_PageContainer.html">components/layout/PageContainer</a></li><li><a href="module-components_layout_PageContent.html">components/layout/PageContent</a></li><li><a href="module-components_layout_PageFooter.html">components/layout/PageFooter</a></li><li><a href="module-components_layout_PageHeader.html">components/layout/PageHeader</a></li><li><a href="module-components_login_LoginForm.html">components/login/LoginForm</a></li><li><a href="module-easteregg.html">easteregg</a></li><li><a href="module-main.html">main</a></li><li><a href="module-router_index.html">router/index</a></li><li><a href="module-services_config.html">services/config</a></li><li><a href="module-services_MarketplaceService.html">services/MarketplaceService</a></li><li><a href="module-services_RuntimeService.html">services/RuntimeService</a></li><li><a href="module-store_actions.html">store/actions</a></li><li><a href="module-store_getters.html">store/getters</a></li><li><a href="module-store_index.html">store/index</a></li><li><a href="module-store_mutation-types.html">store/mutation-types</a></li><li><a href="module-store_mutations.html">store/mutations</a></li><li><a href="module-views_Account.html">views/Account</a></li><li><a href="module-views_Administration.html">views/Administration</a></li><li><a href="module-views_BotCreate.html">views/BotCreate</a></li><li><a href="module-views_BotEdit.html">views/BotEdit</a></li><li><a href="module-views_Login.html">views/Login</a></li><li><a href="module-views_Marketplace.html">views/Marketplace</a></li><li><a href="module-views_Overview.html">views/Overview</a></li><li><a href="module-views_UserCreate.html">views/UserCreate</a></li><li><a href="module-vueMaterial.html">vueMaterial</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Dec 17 2017 21:06:51 GMT+0100 (W. Europe Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
